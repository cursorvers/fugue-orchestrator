name: line-get-user-id (one-time)

on:
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  get-user-id:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: Verify bot and get user ID
        env:
          LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
        run: |
          set -euo pipefail
          echo "=== Bot Info (should be Cursorvers / @529ybhfo) ==="
          curl -sS https://api.line.me/v2/bot/info \
            -H "Authorization: Bearer ${LINE_CHANNEL_ACCESS_TOKEN}" | jq .
          echo ""
          echo "=== Followers ==="
          curl -sS https://api.line.me/v2/bot/followers/ids \
            -H "Authorization: Bearer ${LINE_CHANNEL_ACCESS_TOKEN}" | jq . || true
          echo ""
          echo "=== Recent delivery count ==="
          curl -sS https://api.line.me/v2/bot/message/quota/consumption \
            -H "Authorization: Bearer ${LINE_CHANNEL_ACCESS_TOKEN}" | jq . || true
